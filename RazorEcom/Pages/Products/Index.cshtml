@page
@model RazorEcom.Pages.Products.IndexModel
@{
    ViewData["Title"] = "Cửa hàng";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}
<!-- CSS tùy chỉnh cho các thẻ danh mục -->
<style>
    .category-card {
        display: block;
        padding: 0.75rem 1.25rem;
        border: 1px solid #444;
        border-radius: 0.5rem;
        text-decoration: none;
        color: #f0f0f0;
        background-color: #2b2b2b;
        transition: all 0.2s ease-in-out;
        text-align: center;
        font-weight: 500;
        margin-bottom: 0.5rem; /* Thêm khoảng cách cho mobile */
    }

        .category-card:hover {
            background-color: #3a3a3a;
            border-color: #ff7f50; /* Màu cam theme của bạn */
            color: #f0f0f0;
        }

        /* Kiểu cho thẻ đang được chọn */
        .category-card.active {
            background-color: #ff7f50;
            border-color: #ff7f50;
            color: #1e1e1e;
            font-weight: bold;
        }
</style>

<div class="container py-5">
    <h1 class="fw-bold text-light mb-4">Cửa hàng</h1>

    <!-- 1. Các Thẻ Danh mục (dùng Hyperlinks) -->
    <div class="row mb-4">
        <label class="form-label text-light fw-semibold">Chọn danh mục:</label>
        <div class="col-12">
            <!--
              d-flex flex-wrap gap-2:
              Sử dụng flexbox để các thẻ tự động xuống hàng khi không đủ chỗ
            -->
            <div class="d-flex flex-wrap gap-2">
                <!-- Nút "Tất cả" -->
                <a asp-page="/Products/Index"
                   asp-route-SortBy="@Model.SortBy"
                   asp-route-CategoryId=""
                   class="category-card @(Model.CategoryId == null ? "active" : "")">
                    Tất cả sản phẩm
                </a>

                <!-- Lặp qua các danh mục -->
                @foreach (var category in Model.Categories)
                {
                    <a asp-page="/Products/Index"
                       asp-route-CategoryId="@category.Id"
                       asp-route-SortBy="@Model.SortBy"
                       class="category-card @(Model.CategoryId == category.Id ? "active" : "")">
                        @category.Name
                    </a>
                }
            </div>
        </div>
    </div>

    <!-- 2. Sắp xếp (dùng Form riêng) -->
    <div class="row mb-4">
        <div class="col-md-6">
            <form method="get">
                <!--
                  Thêm hidden input để "nhớ" CategoryId
                  khi thay đổi sắp xếp
                -->
                <input type="hidden" asp-for="CategoryId" />

                <label class="form-label text-light fw-semibold">Sắp xếp:</label>
                <div class="d-flex gap-2">
                    <select asp-for="SortBy"
                            asp-items="Model.SortOptions"
                            class="form-select w-auto bg-dark text-light">
                    </select>
                    <!--
                      Thêm onchange="this.form.submit()"
                      để tự động lọc khi người dùng chọn
                    -->
                    <noscript>
                        <button type="submit" class="btn btn-primary">Lọc</button>
                    </noscript>
                </div>
            </form>
        </div>
    </div>

    <!-- 3. Danh sách Sản phẩm (Không thay đổi nhiều) -->
    <div class="row g-4" id="productsContainer">
        @foreach (var variant in Model.ProductVariants)
        {
            <div class="col-md-4 product-card">
                <div class="card h-100 shadow-sm rounded-4 bg-dark text-light">
                    <img src="@variant.ImageUrl"
                         class="card-img-top"
                         alt="@variant.Product.Name"
                         style="aspect-ratio: 1/1; object-fit: cover;"
                         onerror="this.src='https://placehold.co/600x600/212529/FFF?text=Image+Error'" />

                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">@variant.Product.Name</h5>
                        <p class="card-text text-muted small">@variant.Size - @variant.Color</p>
                        <p class="card-text text-warning fw-semibold fs-5">@variant.Price.ToString("C0")</p>
                        <a asp-page="./Detail" asp-route-id="@variant.ProductId" class="btn btn-primary mt-auto rounded-pill">
                            Xem chi tiết
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        // Thêm script để tự động submit form sắp xếp khi thay đổi
        document.addEventListener('DOMContentLoaded', function() {
            const sortSelect = document.querySelector('select[name="SortBy"]');
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    this.form.submit();
                });
            }
        });
    </script>
}