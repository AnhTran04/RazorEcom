@page
@using System.Globalization
@model RazorEcom.Pages.IndexModel
@{
    ViewData["Title"] = "Trang Chủ";
    Layout="~/Pages/Shared/_Layout.cshtml";
}

<!-- CSS được đưa trực tiếp vào đây để tránh lỗi Layout -->
<style>
    :root {
        --primary-color: #4F46E5; /* Indigo hiện đại */
        --secondary-color: #10B981; /* Emerald */
        --text-dark: #1F2937;
        --text-muted: #6B7280;
        --bg-light: #F9FAFB;
        --card-radius: 16px;
    }

    body {
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        color: var(--text-dark);
    }

    /* Hero Section */
    .hero-section {
        background: linear-gradient(135deg, #EEF2FF 0%, #E0E7FF 100%);
        position: relative;
        overflow: hidden;
    }

    .hero-blob {
        position: absolute;
        filter: blur(80px);
        z-index: 0;
        opacity: 0.6;
    }

    /* Hover Effects */
    .hover-scale {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .hover-scale:hover {
        transform: scale(1.02);
    }

    .hover-lift {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .hover-lift:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important;
    }

    /* Product Card */
    .product-card {
        border: 1px solid rgba(0,0,0,0.05);
        border-radius: var(--card-radius);
        overflow: hidden;
        background: white;
        position: relative; /* Quan trọng cho stretched-link */
    }

    .product-image-wrapper {
        position: relative;
        overflow: hidden;
        padding-top: 100%; /* Aspect Ratio 1:1 */
    }

    .product-image-wrapper img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .product-card:hover .product-image-wrapper img {
        transform: scale(1.1);
    }

    .action-buttons {
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%) translateY(20px);
        opacity: 0;
        transition: all 0.3s ease;
        display: flex;
        gap: 10px;
        z-index: 2; /* Cao hơn stretched-link để bấm được nút */
    }

    .product-card:hover .action-buttons {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }

    .btn-action {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: white;
        color: var(--text-dark);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transition: all 0.2s;
        border: none;
        text-decoration: none;
    }

    .btn-action:hover {
        background: var(--primary-color);
        color: white;
    }

    /* Category Card */
    .category-card {
        border-radius: var(--card-radius);
        overflow: hidden;
        position: relative;
    }
    .category-overlay {
        background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 100%);
    }
</style>

<!-- ==================== HERO SECTION ==================== -->
<section class="hero-section py-5 d-flex align-items-center min-vh-75">
    <!-- Decorative Blobs -->
    <div class="hero-blob bg-primary rounded-circle" style="width: 400px; height: 400px; top: -100px; right: -50px;"></div>
    <div class="hero-blob bg-info rounded-circle" style="width: 300px; height: 300px; bottom: 0; left: -100px;"></div>

    <div class="container position-relative z-1">
        <div class="row align-items-center">
            <div class="col-lg-6 mb-5 mb-lg-0" data-aos="fade-right">
                <div class="d-inline-block mb-4">
                    <span class="badge bg-white text-primary shadow-sm px-3 py-2 rounded-pill fw-bold border border-primary border-opacity-10">
                        <i class="bi bi-stars me-1 text-warning"></i> BST Mùa Hè 2025
                    </span>
                </div>
                <h1 class="display-3 fw-bold mb-4 text-dark lh-sm">
                    Định Hình <br>
                    <span class="text-primary position-relative">
                        Phong Cách
                        <svg class="position-absolute start-0 bottom-0 w-100 text-warning opacity-50" height="12" viewBox="0 0 100 12" preserveAspectRatio="none" style="z-index: -1;">
                            <path d="M0,10 Q50,0 100,10" stroke="currentColor" stroke-width="8" fill="none" />
                        </svg>
                    </span>
                    Của Bạn
                </h1>
                <p class="lead text-muted mb-5 pe-lg-5">
                    Khám phá những thiết kế độc bản, chất liệu cao cấp và xu hướng thời trang mới nhất. Tự tin tỏa sáng cùng RazorEcom.
                </p>
                <div class="d-flex gap-3">
                    <a asp-page="/Products/Index" class="btn btn-primary btn-lg rounded-pill px-5 py-3 shadow-lg hover-lift fw-semibold">
                        Mua Sắm Ngay
                    </a>
                    <a href="#featured" class="btn btn-outline-dark btn-lg rounded-pill px-4 py-3 hover-lift bg-white border-0 shadow-sm fw-semibold">
                        <i class="bi bi-play-circle me-2"></i>Xem Video
                    </a>
                </div>
                
                <div class="mt-5 pt-4 d-flex gap-5 border-top border-dark border-opacity-10">
                    <div>
                        <h4 class="fw-bold mb-0 text-dark">10K+</h4>
                        <small class="text-muted">Khách hàng tin dùng</small>
                    </div>
                    <div>
                        <h4 class="fw-bold mb-0 text-dark">500+</h4>
                        <small class="text-muted">Sản phẩm Premium</small>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6 text-center" data-aos="fade-left">
                <div class="position-relative d-inline-block">
                    <!-- Main Image -->
                    <img src="https://placehold.co/500x600/4F46E5/FFF?text=Model+2025" 
                         class="img-fluid rounded-4 shadow-lg position-relative z-2" 
                         style="transform: rotate(2deg);"
                         alt="Fashion Model" />
                    
                    <!-- Back Image -->
                    <img src="https://placehold.co/500x600/E0E7FF/4F46E5?text=Back" 
                         class="img-fluid rounded-4 position-absolute start-0 top-0 shadow-sm" 
                         style="z-index: 1; transform: rotate(-3deg) scale(0.95); opacity: 0.8;"
                         alt="Decor" />

                    <!-- Floating Card -->
                    <div class="position-absolute bottom-0 start-0 mb-4 ms-n3 bg-white p-3 rounded-4 shadow-lg d-none d-md-block animate__animated animate__bounceIn" style="z-index: 3;">
                        <div class="d-flex align-items-center gap-3">
                            <div class="bg-success bg-opacity-10 p-2 rounded-circle text-success">
                                <i class="bi bi-shield-check-fill fs-4"></i>
                            </div>
                            <div class="text-start">
                                <span class="d-block text-muted small">Đảm bảo</span>
                                <span class="fw-bold text-dark">Chính hãng 100%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ==================== FEATURES / USP ==================== -->
<section class="py-5 bg-white border-bottom">
    <div class="container">
        <div class="row g-4 justify-content-center">
            <div class="col-md-3 col-6" data-aos="fade-up" data-aos-delay="0">
                <div class="d-flex align-items-center gap-3 p-3 rounded-3 hover-scale bg-light bg-opacity-50 h-100">
                    <i class="bi bi-truck text-primary fs-1"></i>
                    <div>
                        <h6 class="fw-bold mb-1">Miễn phí ship</h6>
                        <small class="text-muted">Đơn hàng > 500k</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-6" data-aos="fade-up" data-aos-delay="100">
                <div class="d-flex align-items-center gap-3 p-3 rounded-3 hover-scale bg-light bg-opacity-50 h-100">
                    <i class="bi bi-arrow-repeat text-success fs-1"></i>
                    <div>
                        <h6 class="fw-bold mb-1">Đổi trả 30 ngày</h6>
                        <small class="text-muted">Thủ tục đơn giản</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-6" data-aos="fade-up" data-aos-delay="200">
                <div class="d-flex align-items-center gap-3 p-3 rounded-3 hover-scale bg-light bg-opacity-50 h-100">
                    <i class="bi bi-credit-card text-warning fs-1"></i>
                    <div>
                        <h6 class="fw-bold mb-1">Thanh toán an toàn</h6>
                        <small class="text-muted">Bảo mật tuyệt đối</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-6" data-aos="fade-up" data-aos-delay="300">
                <div class="d-flex align-items-center gap-3 p-3 rounded-3 hover-scale bg-light bg-opacity-50 h-100">
                    <i class="bi bi-headset text-danger fs-1"></i>
                    <div>
                        <h6 class="fw-bold mb-1">Hỗ trợ 24/7</h6>
                        <small class="text-muted">Luôn sẵn sàng</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ==================== CATEGORIES ==================== -->
<section class="py-5 my-5">
    <div class="container">
        <div class="text-center mb-5" data-aos="fade-up">
            <h6 class="text-primary fw-bold text-uppercase letter-spacing-2 mb-2">Bộ Sưu Tập</h6>
            <h2 class="fw-bold display-6">Phong Cách Theo Danh Mục</h2>
        </div>

        <div class="row g-4">
            @foreach (var category in Model.Categories.Take(4))
            {
                <div class="col-md-6 col-lg-3" data-aos="fade-up" data-aos-delay="@(Model.Categories.IndexOf(category) * 100)">
                    <a asp-page="/Products/Index" asp-route-categoryId="@category.Id" class="category-card d-block h-100 text-white text-decoration-none shadow-sm hover-lift">
                        <div class="position-relative h-100" style="min-height: 280px;">
                            <img src="https://placehold.co/400x500/333/FFF?text=@category.Name" 
                                 class="w-100 h-100 object-fit-cover position-absolute top-0 start-0" 
                                 alt="@category.Name">
                            <div class="category-overlay position-absolute bottom-0 start-0 w-100 h-50 d-flex align-items-end p-4">
                                <div>
                                    <h4 class="fw-bold mb-1">@category.Name</h4>
                                    <span class="small fw-light"><i class="bi bi-arrow-right me-1"></i> Khám phá ngay</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            }
        </div>
    </div>
</section>

<!-- ==================== FEATURED PRODUCTS ==================== -->
<section id="featured" class="py-5 bg-light">
    <div class="container">
        <div class="d-flex justify-content-between align-items-end mb-5" data-aos="fade-up">
            <div>
                <h6 class="text-primary fw-bold text-uppercase mb-2">Sản phẩm nổi bật</h6>
                <h2 class="fw-bold display-6 mb-0">Xu Hướng Mới</h2>
            </div>
            <a asp-page="/Products/Index" class="btn btn-outline-dark rounded-pill px-4 fw-medium d-none d-md-inline-flex hover-lift">
                Xem Tất Cả <i class="bi bi-arrow-right ms-2"></i>
            </a>
        </div>

        <div class="row g-4">
            @foreach (var product in Model.FeaturedProducts.Take(8))
            {
                var variants = product.Variants;
                var firstVariant = variants?.FirstOrDefault();
                // TẠO URL CHI TIẾT DỰA TRÊN ID CỦA VARIANT
                var detailUrl = firstVariant != null ? $"/Products/Detail/{firstVariant.Id}" : $"/Products/Index";
                var price = firstVariant?.Price ?? 0;

                <div class="col-6 col-md-4 col-lg-3" data-aos="fade-up" data-aos-delay="@((Model.FeaturedProducts.IndexOf(product) * 50))">
                    <div class="card product-card h-100 shadow-sm hover-lift border-0">
                        <div class="product-image-wrapper">
                            <!-- Badge -->
                            <span class="position-absolute top-0 start-0 m-3 badge bg-danger rounded-pill shadow-sm z-2">-20%</span>
                            
                            <!-- Image -->
                            <img src="@(firstVariant?.ImageUrl ?? product.ImageUrl ?? "https://placehold.co/600x600/f3f4f6/9ca3af?text=No+Image")" 
                                 alt="@product.Name"
                                 onerror="this.src='https://placehold.co/600x600/f3f4f6/9ca3af?text=Image+Error'" />

                            <!-- Action Buttons -->
                            <div class="action-buttons">
                                <a href="@detailUrl" class="btn-action" data-bs-toggle="tooltip" title="Xem chi tiết">
                                    <i class="bi bi-eye"></i>
                                </a>
                                @if (firstVariant != null)
                                {
                                    <form method="post" asp-page-handler="AddToCart" class="d-inline">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="variantId" value="@firstVariant.Id" />
                                        <button type="submit" class="btn-action" data-bs-toggle="tooltip" title="Thêm vào giỏ">
                                            <i class="bi bi-bag-plus"></i>
                                        </button>
                                    </form>
                                }
                            </div>
                        </div>

                        <div class="card-body p-3">
                            <div class="text-muted small mb-1 text-uppercase fw-semibold" style="font-size: 0.7rem;">@product.Brand</div>
                            <h6 class="card-title fw-bold text-truncate mb-2">
                                <!-- STRETCHED-LINK GIÚP CLICK VÀO CARD SẼ NHẢY SANG LINK NÀY -->
                                <a href="@detailUrl" class="text-dark text-decoration-none stretched-link">@product.Name</a>
                            </h6>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="fw-bold text-primary fs-5">
                                    @price.ToString("C0", new CultureInfo("vi-VN"))
                                </span>
                                <div class="text-warning small">
                                    <i class="bi bi-star-fill"></i> 4.9
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="text-center mt-5 d-md-none">
            <a asp-page="/Products/Index" class="btn btn-outline-dark rounded-pill px-5 py-3 w-100 fw-bold">
                Xem Tất Cả Sản Phẩm
            </a>
        </div>
    </div>
</section>

<!-- ==================== NEWSLETTER ==================== -->
<section class="py-5 position-relative overflow-hidden" style="background-color: #111827;">
    <div class="position-absolute top-0 end-0 opacity-10 pe-none">
        <i class="bi bi-envelope-paper text-white" style="font-size: 400px; transform: rotate(-15deg) translate(100px, -50px);"></i>
    </div>
    <div class="container position-relative z-2 py-4">
        <div class="row align-items-center justify-content-center text-center">
            <div class="col-lg-8" data-aos="zoom-in">
                <span class="badge bg-primary bg-opacity-25 text-primary-emphasis border border-primary mb-3">Newsletter</span>
                <h2 class="fw-bold text-white mb-3">Đăng Ký Nhận Tin Tức</h2>
                <p class="text-white-50 mb-5 px-lg-5">
                    Đừng bỏ lỡ các ưu đãi độc quyền, bộ sưu tập mới và bí quyết thời trang. 
                    Chúng tôi cam kết không spam.
                </p>
                <form class="row g-2 justify-content-center">
                    <div class="col-md-6">
                        <input type="email" class="form-control form-control-lg rounded-pill px-4 border-0" 
                               placeholder="Địa chỉ email của bạn..." required>
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-primary btn-lg w-100 rounded-pill fw-bold hover-lift shadow-lg">
                            Đăng Ký
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({
            duration: 800,
            easing: 'cubic-bezier(0.4, 0, 0.2, 1)', // Easing mượt mà hơn
            once: true,
            offset: 50
        });

        // Initialize Tooltips (Bootstrap 5)
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    </script>
}